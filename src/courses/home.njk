---
layout: layouts/base.njk
pagination:
  data: coursesList
  size: 1
  alias: c
permalink: "/courses/{{ c.slug }}/index.html"
---
{% import "components/course_nav.njk" as cn %}
{% import "macros/i18n.njk" as i18nMacro %}
{{ cn.nav(c, coursesList, 'home', currentLang, i18n) }}

{# JSON-LD structured data for AI and search engines #}
<script type="application/ld+json">
{{ c | jsonLD(site) | safe }}
</script>

{% if c.hero_image %}
<div class="course-hero">
  <img class="course-hero-image" src="https://drive.google.com/thumbnail?id={{ c.hero_image }}&sz=w800" alt="{{ c.title }} hero image" loading="lazy">
  <div class="course-hero-overlay"></div>
</div>
{% endif %}

{# Use i18n macro for cleaner field access with automatic fallback #}
{% set courseTitle = i18nMacro.cf(c, 'title', currentLang) %}
{% set courseGrade = i18nMacro.cf(c, 'grade', currentLang) %}
{% set courseSemester = i18nMacro.cf(c, 'semester', currentLang) %}
{% set courseUnit = i18nMacro.cf(c, 'unit', currentLang) %}
{% set courseDomain = i18nMacro.cf(c, 'domain', currentLang) %}
{% set courseTeacher = i18nMacro.cf(c, 'teacher', currentLang) %}
{% set courseOverview = i18nMacro.cf(c, 'overview', currentLang) %}
{% set courseLearningObjectives = i18nMacro.cf(c, 'learningObjectives', currentLang) %}

<section class="space-y-6">
  <header id="course-header" data-course-i18n="{{ c.i18n | json }}">
    <h1 class="text-2xl md:text-3xl font-semibold" data-i18n-course="title">{{ courseTitle }}</h1>
    <p class="text-stone-600">
      <span data-i18n-course="grade">{{ courseGrade }}</span>・
      <span data-i18n-course="semester">{{ courseSemester }}</span>｜
      <span data-i18n-course="unit">{{ courseUnit }}</span>｜
      <span data-i18n-course="domain">{{ courseDomain }}</span>
    </p>
  </header>

  <article class="prose prose-stone max-w-none">
    <section id="course-overview" class="mb-8">
      <h2>{{ i18n[currentLang].course.overview }}</h2>
      {% if c.docs and c.docs.course_description and c.docs.course_description.content %}
        {% if c.docs.course_description.mimeType == 'application/vnd.google-apps.document' or c.docs.course_description.mimeType.startsWith('text/') %}
          <div class="course-description">{{ c.docs.course_description.content | formatGoogleDoc | safe }}</div>
        {% else %}
          <div class="whitespace-pre-wrap">{{ c.docs.course_description.content }}</div>
          <a href="{{ c.docs.course_description.downloadUrl }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 transition-colors mt-3">
            <span>{{ i18n[currentLang].course.open_document }}</span>
          </a>
        {% endif %}
      {% else %}
        <p>{{ courseOverview or i18n[currentLang].course.no_description }}</p>
      {% endif %}
    </section>

    {% if courseLearningObjectives and courseLearningObjectives.length > 0 %}
    <section id="learning-objectives" class="border-t border-stone-200 pt-6">
      <h2>{{ i18n[currentLang].course.learning_objectives }}</h2>
      <ul class="list-disc list-inside space-y-2">
        {% for objective in courseLearningObjectives %}
        <li>{{ objective }}</li>
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <section id="teacher-bio" class="border-t border-stone-200 pt-6">
      <h2>{{ i18n[currentLang].course.teacher_intro }}</h2>
      <p>{{ courseTeacher or i18n[currentLang].course.no_teacher_bio }}</p>
    </section>
  </article>
</section>
