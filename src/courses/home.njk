---
layout: layouts/base.njk
hidePagefindSearch: true
pagination:
  data: coursesList
  size: 1
  alias: c
permalink: "/courses/{{ c.slug }}/index.html"
---
{% import "components/course-breadcrumb.njk" as breadcrumb with context %}
{% import "macros/i18n.njk" as i18nMacro %}

{# Course navigation with home pill highlighted and materials dropdown #}
{{ breadcrumb.breadcrumb(c, coursesList, 'home', currentLang, i18n) }}

{# Innovation page link - shown prominently if available #}
{% set innovation = courseInnovations[c.slug] %}
{% if innovation %}
<div class="mb-6 px-4 py-3 bg-amber-50 border-l-4 border-amber-600 rounded-r-md">
  <div class="flex items-center justify-between gap-4 flex-wrap">
    <div>
      <a href="{{ '/courses/' | url }}{{ c.slug }}/innovation/"
        class="inline-flex items-center gap-2 bg-amber-600 text-white px-4 py-2 rounded-md hover:bg-amber-700 transition-colors whitespace-nowrap text-sm font-medium">
        {{ i18n[currentLang].course.innovation }}
        <span aria-hidden="true">→</span>
      </a>
      <p class="text-sm text-amber-800">
        {% if currentLang == 'en-US' %}
          Explore the teaching innovations and pedagogical insights for this course.
        {% else %}
          探索本課程的教學反思與創新。
        {% endif %}
      </p>
    </div>
  </div>
</div>
{% endif %}

{# JSON-LD structured data for AI and search engines #}
<script type="application/ld+json">
{{ c | jsonLD(site) | safe }}
</script>

{# Use i18n macro for cleaner field access with automatic fallback #}
{% set courseOverview = i18nMacro.cf(c, 'overview', currentLang) %}
{% set courseLearningObjectives = courseHelpers.getI18nField(c, 'learningObjectives', currentLang) %}
{% set courseTeacher = i18nMacro.cf(c, 'teacher', currentLang) %}
{% set courseDescriptionDoc = materialHelpers.getDoc(c, 'course_description') %}
{% set syllabusPdfs = materialHelpers.getMaterialItems(c, 'syllabus') %}
{% set worksheetPdfs = materialHelpers.getMaterialItems(c, 'worksheet') %}
{% set hasDownloadMaterials = (syllabusPdfs | length) > 0 or (worksheetPdfs | length) > 0 %}

<section class="space-y-6" data-course-i18n="{{ c.i18n | json }}">
  {# Hidden English content for Pagefind full-text search indexing #}
  {% if c.i18n and c.i18n['en-US'] %}
  <div style="position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden;" aria-hidden="true" lang="en-US">
    {{ c.i18n['en-US'].title }}
    {{ c.i18n['en-US'].grade }} {{ c.i18n['en-US'].semester }}
    {{ c.i18n['en-US'].unit }} {{ c.i18n['en-US'].domain }}
    {{ c.i18n['en-US'].overview }}
    {{ c.i18n['en-US'].teacher }}
  </div>
  {% endif %}
  <article class="prose prose-stone max-w-none">
    <section id="course-overview" class="mb-8">
      <h2>{{ i18n[currentLang].course.overview }}</h2>
      {% if courseDescriptionDoc and courseDescriptionDoc.content %}
        {% set docMime = courseDescriptionDoc.mimeType or '' %}
        {% if docMime == 'application/vnd.google-apps.document' or (docMime and docMime.startsWith('text/')) %}
          <div class="course-description">{{ courseDescriptionDoc.content | formatGoogleDoc | autoLink | safe }}</div>
        {% else %}
          <div class="whitespace-pre-wrap">{{ courseDescriptionDoc.content | autoLink | safe }}</div>
          <a href="{{ courseDescriptionDoc.downloadUrl }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 transition-colors mt-3">
            <span>{{ i18n[currentLang].course.open_document }}</span>
          </a>
        {% endif %}
      {% else %}
        <p>{{ courseOverview or i18n[currentLang].course.no_description }}</p>
      {% endif %}
    </section>

    {% if courseLearningObjectives and (courseLearningObjectives | length) > 0 %}
    <section id="learning-objectives" class="border-t border-stone-200 pt-6">
      <h2>{{ i18n[currentLang].course.learning_objectives }}</h2>
      <ul class="list-disc list-inside space-y-2" data-i18n-course-list="learningObjectives">
        {% for objective in courseLearningObjectives %}
        <li>{{ objective }}</li>
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <section id="teacher-bio" class="border-t border-stone-200 pt-6">
      <h2>{{ i18n[currentLang].course.teacher_intro }}</h2>
      <p>{{ courseTeacher or i18n[currentLang].course.no_teacher_bio }}</p>
    </section>

    {% if hasDownloadMaterials %}
    <section id="course-downloads" class="border-t border-stone-200 pt-6">
      <h2>{{ i18n[currentLang].course.downloads }}</h2>
      <div class="space-y-6">
        {% if syllabusPdfs and (syllabusPdfs | length) > 0 %}
        <div>
          <h3 class="text-lg font-medium mb-3">{{ i18n[currentLang].course.syllabus }}</h3>
          <ul class="space-y-3">
            {% for pdf in syllabusPdfs %}
              {% set fileName = pdf.title or pdf.name or (i18n[currentLang].course.syllabus ~ ' #' ~ loop.index) %}
              {% set fileUrl = pdf.downloadUrl or (pdf.id and ('https://drive.google.com/file/d/' ~ pdf.id ~ '/view')) %}
              <li class="flex flex-wrap items-center justify-between gap-3 rounded-lg border border-stone-200 bg-stone-50 px-4 py-3">
                <div>
                  <p class="font-medium text-stone-900">{{ fileName }}</p>
                  {% if pdf.sourceTitle %}
                  <p class="text-sm text-stone-500">{{ pdf.sourceTitle }}</p>
                  {% endif %}
                </div>
                {% if fileUrl %}
                <a href="{{ fileUrl }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="inline-flex items-center gap-2 rounded-md border border-blue-200 px-3 py-1.5 text-sm font-medium text-blue-700 hover:bg-blue-50 transition">
                  {{ i18n[currentLang].course.open_document }}
                  <span aria-hidden="true">↗</span>
                </a>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        {% if worksheetPdfs and (worksheetPdfs | length) > 0 %}
        <div>
          <h3 class="text-lg font-medium mb-3">{{ i18n[currentLang].course.worksheet }}</h3>
          <ul class="space-y-3">
            {% for pdf in worksheetPdfs %}
              {% set fileName = pdf.title or pdf.name or (i18n[currentLang].course.worksheet ~ ' #' ~ loop.index) %}
              {% set fileUrl = pdf.downloadUrl or (pdf.id and ('https://drive.google.com/file/d/' ~ pdf.id ~ '/view')) %}
              <li class="flex flex-wrap items-center justify-between gap-3 rounded-lg border border-stone-200 bg-stone-50 px-4 py-3">
                <div>
                  <p class="font-medium text-stone-900">{{ fileName }}</p>
                  {% if pdf.sourceTitle %}
                  <p class="text-sm text-stone-500">{{ pdf.sourceTitle }}</p>
                  {% endif %}
                </div>
                {% if fileUrl %}
                <a href="{{ fileUrl }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="inline-flex items-center gap-2 rounded-md border border-blue-200 px-3 py-1.5 text-sm font-medium text-blue-700 hover:bg-blue-50 transition">
                  {{ i18n[currentLang].course.open_document }}
                  <span aria-hidden="true">↗</span>
                </a>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </section>
    {% endif %}
  </article>
</section>
