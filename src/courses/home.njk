---
layout: layouts/base.njk
hidePagefindSearch: true
pagination:
  data: coursesList
  size: 1
  alias: c
permalink: "/courses/{{ c.slug }}/index.html"
---
{% import "components/course-breadcrumb.njk" as breadcrumb with context %}
{% import "components/course-info-card.njk" as courseCard with context %}
{% import "macros/i18n.njk" as i18nMacro %}

{# Sticky navbar: Breadcrumbs + Course Switcher #}
{{ breadcrumb.unifiedHeader(c, coursesList, 'home', currentLang, i18n) }}

{# Hero Section - Full-width centered course information #}
{{ courseCard.card(c, currentLang, i18n) }}

{# Action Tabs - appears below hero #}
{{ breadcrumb.actionTabs(c, 'home', currentLang, i18n) }}

{# Innovation Teaser Card with Tags - appears below hero on all screen sizes #}
{% set innovation = courseInnovations[c.slug] %}
{% if innovation %}
<div class="innovation-with-tags-wrapper">
  <aside class="innovation-teaser-card" aria-label="{{ i18n[currentLang].course.innovation_section_title }}" data-course-i18n="{{ c.i18n | json }}">
    <div class="innovation-teaser-header">
      <div class="innovation-teaser-icon" aria-hidden="true">ðŸ’¡</div>
      <span class="innovation-section-title">{{ i18n[currentLang].course.innovation_section_title }}</span>
    </div>
    <h3 class="innovation-teaser-question" data-i18n-course="innovation_question">
      {{ i18nMacro.cf(c, 'innovation_question', currentLang) }}
    </h3>
    <p class="innovation-teaser-summary" data-i18n-course="innovation_summary">
      {{ i18nMacro.cf(c, 'innovation_summary', currentLang) }}
    </p>
    <a href="{{ '/courses/' + c.slug + '/innovation/' | url }}"
       class="innovation-teaser-cta">
      {{ i18n[currentLang].course.innovation_cta }}
    </a>
  </aside>

  {# Tags Section #}
  {% if c.metadata and c.metadata.tags and c.metadata.tags.length > 0 %}
  <aside class="innovation-tags-section">
    <h4 class="innovation-tags-header">{{ i18n[currentLang].course.tags or 'æ¨™ç±¤' }}</h4>
    <div class="innovation-tags-list">
      {% for tag in c.metadata.tags %}
      <span class="innovation-tag-pill">#{{ tag }}</span>
      {% endfor %}
    </div>
  </aside>
  {% endif %}
</div>
{% endif %}

{# JSON-LD structured data for AI and search engines #}
<script type="application/ld+json">
{{ c | jsonLD(site) | safe }}
</script>

{# Use i18n macro for cleaner field access with automatic fallback #}
{% set courseOverview = i18nMacro.cf(c, 'overview', currentLang) %}
{% set courseLearningObjectives = courseHelpers.getI18nField(c, 'learningObjectives', currentLang) %}
{% set courseTeacher = i18nMacro.cf(c, 'teacher', currentLang) %}
{% set courseDescriptionDoc = materialHelpers.getDoc(c, 'course_description') %}
{% set syllabusPdfs = materialHelpers.getMaterialItems(c, 'syllabus') %}
{% set worksheetPdfs = materialHelpers.getMaterialItems(c, 'worksheet') %}
{% set hasDownloadMaterials = (syllabusPdfs | length) > 0 or (worksheetPdfs | length) > 0 %}

<section class="space-y-6" data-course-i18n="{{ c.i18n | json }}">
  {# Hidden English content for Pagefind full-text search indexing #}
  {% if c.i18n and c.i18n['en-US'] %}
  <div style="position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden;" aria-hidden="true" lang="en-US">
    {{ c.i18n['en-US'].title }}
    {{ c.i18n['en-US'].grade }} {{ c.i18n['en-US'].semester }}
    {{ c.i18n['en-US'].unit }} {{ c.i18n['en-US'].domain }}
    {{ c.i18n['en-US'].overview }}
    {{ c.i18n['en-US'].teacher }}
  </div>
  {% endif %}
  <article class="prose prose-stone max-w-none">
    <section id="course-overview" class="mb-8">
      <h2>{{ i18n[currentLang].course.overview }}</h2>
      {% if courseDescriptionDoc and courseDescriptionDoc.content %}
        {% set docMime = courseDescriptionDoc.mimeType or '' %}
        {% if docMime == 'application/vnd.google-apps.document' or (docMime and docMime.startsWith('text/')) %}
          <div class="course-description">{{ courseDescriptionDoc.content | formatGoogleDoc | autoLink | safe }}</div>
        {% else %}
          <div class="whitespace-pre-wrap">{{ courseDescriptionDoc.content | autoLink | safe }}</div>
          <a href="{{ courseDescriptionDoc.downloadUrl }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 transition-colors mt-3">
            <span>{{ i18n[currentLang].course.open_document }}</span>
          </a>
        {% endif %}
      {% else %}
        <p data-i18n-course="overview">{{ courseOverview or i18n[currentLang].course.no_description }}</p>
      {% endif %}
    </section>

    {% if courseLearningObjectives and (courseLearningObjectives | length) > 0 %}
    <section id="learning-objectives" class="border-t border-stone-200 pt-6">
      <h2>{{ i18n[currentLang].course.learning_objectives }}</h2>
      <ul class="list-disc list-inside space-y-2" data-i18n-course-list="learningObjectives">
        {% for objective in courseLearningObjectives %}
        <li>{{ objective }}</li>
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <section id="teacher-bio" class="border-t border-stone-200 pt-6">
      <h2>{{ i18n[currentLang].course.teacher_intro }}</h2>
      <p data-i18n-course="teacher">{{ courseTeacher or i18n[currentLang].course.no_teacher_bio }}</p>
    </section>

    {% if hasDownloadMaterials %}
    <section id="course-downloads" class="border-t border-stone-200 pt-6">
      <h2>{{ i18n[currentLang].course.downloads }}</h2>
      <div class="space-y-6">
        {% if syllabusPdfs and (syllabusPdfs | length) > 0 %}
        <div>
          <h3 class="text-lg font-medium mb-3">{{ i18n[currentLang].course.syllabus }}</h3>
          <ul class="space-y-3">
            {% for pdf in syllabusPdfs %}
              {% set fileName = pdf.title or pdf.name or (i18n[currentLang].course.syllabus ~ ' #' ~ loop.index) %}
              {% set fileUrl = pdf.downloadUrl or (pdf.id and ('https://drive.google.com/file/d/' ~ pdf.id ~ '/view')) %}
              <li class="flex flex-wrap items-center justify-between gap-3 rounded-lg border border-stone-200 bg-stone-50 px-4 py-3">
                <div>
                  <p class="font-medium text-stone-900">{{ fileName }}</p>
                  {% if pdf.sourceTitle %}
                  <p class="text-sm text-stone-500">{{ pdf.sourceTitle }}</p>
                  {% endif %}
                </div>
                {% if fileUrl %}
                <a href="{{ fileUrl }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="inline-flex items-center gap-2 rounded-md border border-blue-200 px-3 py-1.5 text-sm font-medium text-blue-700 hover:bg-blue-50 transition">
                  {{ i18n[currentLang].course.open_document }}
                  <span aria-hidden="true">â†—</span>
                </a>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        {% if worksheetPdfs and (worksheetPdfs | length) > 0 %}
        <div>
          <h3 class="text-lg font-medium mb-3">{{ i18n[currentLang].course.worksheet }}</h3>
          <ul class="space-y-3">
            {% for pdf in worksheetPdfs %}
              {% set fileName = pdf.title or pdf.name or (i18n[currentLang].course.worksheet ~ ' #' ~ loop.index) %}
              {% set fileUrl = pdf.downloadUrl or (pdf.id and ('https://drive.google.com/file/d/' ~ pdf.id ~ '/view')) %}
              <li class="flex flex-wrap items-center justify-between gap-3 rounded-lg border border-stone-200 bg-stone-50 px-4 py-3">
                <div>
                  <p class="font-medium text-stone-900">{{ fileName }}</p>
                  {% if pdf.sourceTitle %}
                  <p class="text-sm text-stone-500">{{ pdf.sourceTitle }}</p>
                  {% endif %}
                </div>
                {% if fileUrl %}
                <a href="{{ fileUrl }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="inline-flex items-center gap-2 rounded-md border border-blue-200 px-3 py-1.5 text-sm font-medium text-blue-700 hover:bg-blue-50 transition">
                  {{ i18n[currentLang].course.open_document }}
                  <span aria-hidden="true">â†—</span>
                </a>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </section>
    {% endif %}
  </article>
</section>
