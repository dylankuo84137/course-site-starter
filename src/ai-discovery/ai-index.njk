---
permalink: /ai-index.json
eleventyExcludeFromCollections: true
---
{
  "site": {
    "name": "{{ site.title }}",
    "description": {
      "zh-TW": {{ i18n['zh-TW'].site.description | jsonstr | safe }},
      "en-US": {{ i18n['en-US'].site.description | jsonstr | safe }}
    },
    "homepage": {
      "zh-TW": {
        "hero_title": {{ i18n['zh-TW'].homepage.hero_title | jsonstr | safe }},
        "description": {{ i18n['zh-TW'].site.homepage_description | jsonstr | safe }},
        "ethos_title": {{ i18n['zh-TW'].homepage.ethos_title | jsonstr | safe }},
        "ethos_copy": {{ i18n['zh-TW'].homepage.ethos_copy | jsonstr | safe }},
        "ethos_points": [{% for point in i18n['zh-TW'].homepage.ethos_points %}{{ point | jsonstr | safe }}{{ "," if not loop.last }}{% endfor %}]
      },
      "en-US": {
        "hero_title": {{ i18n['en-US'].homepage.hero_title | jsonstr | safe }},
        "description": {{ i18n['en-US'].site.homepage_description | jsonstr | safe }},
        "ethos_title": {{ i18n['en-US'].homepage.ethos_title | jsonstr | safe }},
        "ethos_copy": {{ i18n['en-US'].homepage.ethos_copy | jsonstr | safe }},
        "ethos_points": [{% for point in i18n['en-US'].homepage.ethos_points %}{{ point | jsonstr | safe }}{{ "," if not loop.last }}{% endfor %}]
      }
    },
    "url": "{% if site.url %}{{ site.url }}{% endif %}",
    "baseUrl": "{{ '/' | url }}",
    "license": "{% if site.license_text %}{{ site.license_text }}{% else %}CC BY-NC-SA{% endif %}",
    "organization": "{{ site.footer_org }}",
    "contact": "{{ site.footer_email }}",
    "buildDate": "{{ buildTime }}",
    "totalCourses": {{ coursesList | length }}
  },
  "courses": [
    {%- for course in coursesList -%}
    {%- set docStory = materialHelpers.getDoc(course, 'story') -%}
    {%- set docPlayScript = materialHelpers.getDoc(course, 'play_script') -%}
    {%- set hasPlayScriptMaterial = materialHelpers.hasMaterial(course, 'play_scripts') -%}
    {%- set hasWorkbook = materialHelpers.hasMaterial(course, 'workbook_photos') or materialHelpers.hasMaterial(course, 'workbook_pdfs') -%}
    {%- set hasPhotos = materialHelpers.hasMaterial(course, 'photos') -%}
    {%- set hasBlackboard = materialHelpers.hasMaterial(course, 'blackboard') -%}
    {%- set hasScripts = materialHelpers.hasMaterial(course, 'scripts_photos') -%}
    {%- set hasAudio = materialHelpers.hasMaterial(course, 'songs_audio') -%}
    {%- set hasSheetMusic = materialHelpers.hasMaterial(course, 'sheet_music') -%}
    {%- set hasVideos = materialHelpers.hasMaterial(course, 'videos') -%}
    {%- set zhTW = course.i18n['zh-TW'] or {} -%}
    {%- set enUS = course.i18n['en-US'] or {} -%}
    {%- set metadata = course.metadata or {} -%}
    {%- set courseTags = metadata.tags or [] -%}
    {
      "slug": "{{ course.slug }}",
      "i18n": {
        "zh-TW": {
          "title": {{ zhTW.title | jsonstr | safe }},
          "grade": {{ zhTW.grade | jsonstr | safe }},
          "semester": {{ zhTW.semester | jsonstr | safe }},
          "unit": {{ zhTW.unit | jsonstr | safe }},
          "domain": {{ zhTW.domain | jsonstr | safe }},
          "teacher": {{ zhTW.teacher | jsonstr | safe }},
          "overview": {{ zhTW.overview | jsonstr | safe }}
          {%- if zhTW.innovation_summary -%}
          ,"innovation_summary": {{ zhTW.innovation_summary | jsonstr | safe }}
          {%- endif -%}
          {%- if zhTW.innovation_question -%}
          ,"innovation_question": {{ zhTW.innovation_question | jsonstr | safe }}
          {%- endif -%}
        },
        "en-US": {
          "title": {{ enUS.title | jsonstr | safe }},
          "grade": {{ enUS.grade | jsonstr | safe }},
          "semester": {{ enUS.semester | jsonstr | safe }},
          "unit": {{ enUS.unit | jsonstr | safe }},
          "domain": {{ enUS.domain | jsonstr | safe }},
          "teacher": {{ enUS.teacher | jsonstr | safe }},
          "overview": {{ enUS.overview | jsonstr | safe }}
          {%- if enUS.innovation_summary -%}
          ,"innovation_summary": {{ enUS.innovation_summary | jsonstr | safe }}
          {%- endif -%}
          {%- if enUS.innovation_question -%}
          ,"innovation_question": {{ enUS.innovation_question | jsonstr | safe }}
          {%- endif -%}
        }
      },
      "metadata": {
        "grade_level": "{{ metadata.grade_level }}",
        "domain_category": "{{ metadata.domain_category }}",
        "teacher_name": "{{ metadata.teacher_name }}",
        "heroImage": {% if course.hero_image %}"{{ course.hero_image }}"{% else %}null{% endif %}
      },
      "url": "{{ ('/courses/' + course.slug + '/') | url }}",
      "tags": [{% for tag in courseTags %}"{{ tag | replace('"', '\\"') }}"{{ "," if not loop.last }}{% endfor %}],
      {% if course.learningObjectives -%}
      "learningObjectives": [{% for obj in course.learningObjectives %}"{{ obj | replace('"', '\\"') }}"{{ "," if not loop.last }}{% endfor %}],
      {% else -%}
      "learningObjectives": [],
      {% endif -%}
      {%- set courseInnovation = courseInnovations[course.slug] -%}
      {%- if courseInnovation -%}
      "innovations": {
        {%- if courseInnovation['zh-TW'] -%}
        "zh-TW": {
          {%- set zhInnovation = courseInnovation['zh-TW'] -%}
          "title": {{ zhInnovation.title | jsonstr | safe }},
          {%- if zhInnovation.author -%}
          "author": {{ zhInnovation.author | jsonstr | safe }},
          {%- endif -%}
          {%- if zhInnovation.innovation_type -%}
          "innovation_type": {{ zhInnovation.innovation_type | jsonstr | safe }},
          {%- endif -%}
          "body": {{ zhInnovation.body | jsonstr | safe }}
        }{{ "," if courseInnovation['en-US'] }}
        {%- endif -%}
        {%- if courseInnovation['en-US'] -%}
        "en-US": {
          {%- set enInnovation = courseInnovation['en-US'] -%}
          "title": {{ enInnovation.title | jsonstr | safe }},
          {%- if enInnovation.author -%}
          "author": {{ enInnovation.author | jsonstr | safe }},
          {%- endif -%}
          {%- if enInnovation.innovation_type -%}
          "innovation_type": {{ enInnovation.innovation_type | jsonstr | safe }},
          {%- endif -%}
          "body": {{ enInnovation.body | jsonstr | safe }}
        }
        {%- endif -%}
      },
      {%- endif -%}
      "pages": {
        "home": "{{ site.url }}{{ ('/courses/' + course.slug + '/') | url }}"
        {%- if docStory -%}
        ,"story": "{{ site.url }}{{ ('/courses/' + course.slug + '/story/') | url }}"
        {%- endif -%}
        ,"play_script": "{{ site.url }}{{ ('/courses/' + course.slug + '/play-script/') | url }}"
        ,"workbook": "{{ site.url }}{{ ('/courses/' + course.slug + '/workbook/') | url }}"
        {%- if hasPhotos -%}
        ,"photos": "{{ site.url }}{{ ('/courses/' + course.slug + '/photos/') | url }}"
        {%- endif -%}
        {%- if hasBlackboard -%}
        ,"blackboard": "{{ site.url }}{{ ('/courses/' + course.slug + '/blackboard/') | url }}"
        {%- endif -%}
        ,"scripts": "{{ site.url }}{{ ('/courses/' + course.slug + '/scripts/') | url }}"
        ,"songs": "{{ site.url }}{{ ('/courses/' + course.slug + '/songs/') | url }}"
        {%- if hasSheetMusic -%}
        ,"sheet_music": "{{ site.url }}{{ ('/courses/' + course.slug + '/sheet-music/') | url }}"
        {%- endif -%}
        {%- if hasVideos -%}
        ,"videos": "{{ site.url }}{{ ('/courses/' + course.slug + '/videos/') | url }}"
        {%- endif -%}
      },
      "materials": {
        "hasStory": {% if docStory %}true{% else %}false{% endif %},
        "hasPlayScript": {% if docPlayScript or hasPlayScriptMaterial %}true{% else %}false{% endif %},
        "hasWorkbook": {% if hasWorkbook %}true{% else %}false{% endif %},
        "hasPhotos": {% if hasPhotos %}true{% else %}false{% endif %},
        "hasBlackboard": {% if hasBlackboard %}true{% else %}false{% endif %},
        "hasScripts": {% if hasScripts %}true{% else %}false{% endif %},
        "hasAudio": {% if hasAudio %}true{% else %}false{% endif %},
        "hasSheetMusic": {% if hasSheetMusic %}true{% else %}false{% endif %},
        "hasVideos": {% if hasVideos %}true{% else %}false{% endif %}
      },
      "docs": {
        {%- if course.docs -%}
        {%- set docEntries = [] -%}
        {%- for docKey, docData in course.docs -%}
          {%- if docData and docData.content -%}
            {%- set _ = docEntries.push({key: docKey, data: docData}) -%}
          {%- endif -%}
        {%- endfor -%}
        {%- for docEntry in docEntries -%}
        "{{ docEntry.key }}": {
          "name": {{ docEntry.data.name | jsonstr | safe }},
          "content": {{ docEntry.data.content | jsonstr | safe }},
          "mimeType": "{{ docEntry.data.mimeType }}",
          "downloadUrl": "{{ docEntry.data.downloadUrl }}",
          "lastSynced": "{{ docEntry.data.lastSynced }}"
        }{{ "," if not loop.last }}
        {%- endfor -%}
        {%- endif -%}
      },
      "driveContent": {
        {%- if course.material -%}
        {%- set materialKeys = ["workbook_photos", "photos", "blackboard", "scripts_photos", "songs_audio", "sheet_music", "workbook_pdfs", "play_scripts", "worksheet", "syllabus", "videos"] -%}
        {%- set materialEntries = [] -%}
        {%- for materialKey in materialKeys -%}
          {%- if course.material[materialKey] -%}
            {%- set allItems = [] -%}
            {%- for entry in course.material[materialKey] -%}
              {%- if entry.items and (entry.items | length) > 0 -%}
                {%- for item in entry.items -%}
                  {%- set _ = allItems.push(item) -%}
                {%- endfor -%}
              {%- elif entry.type == "pdf" and entry.id -%}
                {#- Handle direct PDF entries (syllabus, worksheet) -#}
                {%- set pdfItem = {
                  id: entry.id,
                  name: entry.title or (materialKey | title),
                  mimeType: "application/pdf",
                  tags: entry.tags or [],
                  downloadUrl: "https://drive.google.com/uc?export=download&id=" + entry.id,
                  previewUrl: "https://drive.google.com/file/d/" + entry.id + "/preview"
                } -%}
                {%- set _ = allItems.push(pdfItem) -%}
              {%- elif entry.type == "youtube" and entry.id -%}
                {#- Handle YouTube video entries -#}
                {%- set youtubeItem = {
                  type: "youtube",
                  id: entry.id,
                  title: entry.title or "Video",
                  url: "https://www.youtube.com/watch?v=" + entry.id,
                  embedUrl: "https://www.youtube.com/embed/" + entry.id
                } -%}
                {%- set _ = allItems.push(youtubeItem) -%}
              {%- endif -%}
            {%- endfor -%}
            {%- if (allItems | length) > 0 -%}
              {%- set _ = materialEntries.push({key: materialKey, items: allItems}) -%}
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
        {%- for matEntry in materialEntries -%}
        "{{ matEntry.key }}": [
          {%- for item in matEntry.items -%}
          {
            {%- if item.type == "youtube" -%}
            "type": "youtube",
            "id": "{{ item.id }}",
            "title": {{ item.title | jsonstr | safe }},
            "url": "{{ item.url }}",
            "embedUrl": "{{ item.embedUrl }}"
            {%- else -%}
            "id": "{{ item.id }}",
            "name": "{{ item.name | replace('"', '\\"') }}",
            "mimeType": "{{ item.mimeType }}",
            "tags": [{% for tag in item.tags %}"{{ tag | replace('"', '\\"') }}"{{ "," if not loop.last }}{% endfor %}],
            "downloadUrl": "{{ item.downloadUrl }}",
            "previewUrl": "{{ item.previewUrl }}",
            "thumbnailUrl": "https://drive.google.com/thumbnail?id={{ item.id }}&sz=w400",
            "directViewUrl": "https://drive.google.com/uc?export=view&id={{ item.id }}"
            {%- if item.mimeType == "application/pdf" and pdfTextCache and pdfTextCache[course.slug] and pdfTextCache[course.slug][matEntry.key] and pdfTextCache[course.slug][matEntry.key][item.id] -%}
            {%- set pdfCache = pdfTextCache[course.slug][matEntry.key][item.id] -%}
            ,"pdfText": {{ pdfCache.text | jsonstr | safe }}
            ,"pdfTextLastSynced": "{{ pdfCache.lastSynced }}"
            {%- endif -%}
            {%- endif -%}
          }{{ "," if not loop.last }}
          {%- endfor -%}
        ]{{ "," if not loop.last }}
        {%- endfor -%}
        {%- endif -%}
      }
    }{{ "," if not loop.last }}
    {%- endfor -%}
  ],
  "statistics": {
    {%- set allGrades = [] -%}
    {%- set allDomains = [] -%}
    {%- set allTeachers = [] -%}
    {%- set allTags = [] -%}
    {%- for course in coursesList -%}
      {%- if course.metadata.grade_level and allGrades.indexOf(course.metadata.grade_level) == -1 -%}
        {%- set allGrades = allGrades.concat([course.metadata.grade_level]) -%}
      {%- endif -%}
      {%- if course.metadata.domain_category and allDomains.indexOf(course.metadata.domain_category) == -1 -%}
        {%- set allDomains = allDomains.concat([course.metadata.domain_category]) -%}
      {%- endif -%}
      {%- if course.metadata.teacher_name and allTeachers.indexOf(course.metadata.teacher_name) == -1 -%}
        {%- set allTeachers = allTeachers.concat([course.metadata.teacher_name]) -%}
      {%- endif -%}
      {%- if course.metadata.tags -%}
        {%- for tag in course.metadata.tags -%}
          {%- if allTags.indexOf(tag) == -1 -%}
            {%- set allTags = allTags.concat([tag]) -%}
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}
    {%- endfor -%}
    "totalGrades": {{ allGrades.length }},
    "totalDomains": {{ allDomains.length }},
    "totalTeachers": {{ allTeachers.length }},
    "uniqueTags": {{ allTags.length }},
    "grades": [{% for grade in allGrades %}"{{ grade }}"{{ "," if not loop.last }}{% endfor %}],
    "domains": [{% for domain in allDomains %}"{{ domain }}"{{ "," if not loop.last }}{% endfor %}],
    "teachers": [{% for teacher in allTeachers %}{{ teacher | jsonstr | safe }}{{ "," if not loop.last }}{% endfor %}],
    "tags": [{% for tag in allTags %}{{ tag | jsonstr | safe }}{{ "," if not loop.last }}{% endfor %}]
  },
  "usage": {
    "description": "This AI-readable index provides structured access to all course data",
    "queryExamples": [
      "List all Grade 2 courses",
      "Find courses by teacher name",
      "Get all drama courses",
      "Compare blackboard drawing across grades"
    ],
    "documentation": "{{ '/for-ai/' | url }}"
  }
}
