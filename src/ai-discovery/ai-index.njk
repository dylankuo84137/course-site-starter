---
permalink: /ai-index.json
eleventyExcludeFromCollections: true
---
{
  "site": {
    "name": "{{ site.title }}",
    "description": "Waldorf education course materials including workbooks, blackboard drawings, photos, and audio recordings",
    "url": "{% if site.url %}{{ site.url }}{% endif %}",
    "baseUrl": "{{ '/' | url }}",
    "license": "{% if site.license_text %}{{ site.license_text }}{% else %}CC BY-NC-SA{% endif %}",
    "organization": "{{ site.footer_org }}",
    "contact": "{{ site.footer_email }}",
    "buildDate": "{{ buildTime }}",
    "totalCourses": {{ coursesList | length }}
  },
  "courses": [
    {%- for course in coursesList -%}
    {%- set docStory = materialHelpers.getDoc(course, 'story') -%}
    {%- set docPlayScript = materialHelpers.getDoc(course, 'play_script') -%}
    {%- set hasPlayScriptMaterial = materialHelpers.hasMaterial(course, 'play_scripts') -%}
    {%- set hasWorkbook = materialHelpers.hasMaterial(course, 'workbook_photos') or materialHelpers.hasMaterial(course, 'workbook_pdfs') -%}
    {%- set hasPhotos = materialHelpers.hasMaterial(course, 'photos') -%}
    {%- set hasBlackboard = materialHelpers.hasMaterial(course, 'blackboard') -%}
    {%- set hasScripts = materialHelpers.hasMaterial(course, 'scripts_photos') -%}
    {%- set hasAudio = materialHelpers.hasMaterial(course, 'songs_audio') -%}
    {%- set hasSheetMusic = materialHelpers.hasMaterial(course, 'sheet_music') -%}
    {%- set hasVideos = materialHelpers.hasMaterial(course, 'videos') -%}
    {%- set zhTW = course.i18n['zh-TW'] or {} -%}
    {%- set enUS = course.i18n['en-US'] or {} -%}
    {%- set metadata = course.metadata or {} -%}
    {%- set courseTags = metadata.tags or [] -%}
    {
      "slug": "{{ course.slug }}",
      "i18n": {
        "zh-TW": {
          "title": {{ zhTW.title | jsonstr | safe }},
          "grade": {{ zhTW.grade | jsonstr | safe }},
          "semester": {{ zhTW.semester | jsonstr | safe }},
          "unit": {{ zhTW.unit | jsonstr | safe }},
          "domain": {{ zhTW.domain | jsonstr | safe }},
          "teacher": {{ zhTW.teacher | jsonstr | safe }},
          "overview": {{ zhTW.overview | jsonstr | safe }}
        },
        "en-US": {
          "title": {{ enUS.title | jsonstr | safe }},
          "grade": {{ enUS.grade | jsonstr | safe }},
          "semester": {{ enUS.semester | jsonstr | safe }},
          "unit": {{ enUS.unit | jsonstr | safe }},
          "domain": {{ enUS.domain | jsonstr | safe }},
          "teacher": {{ enUS.teacher | jsonstr | safe }},
          "overview": {{ enUS.overview | jsonstr | safe }}
        }
      },
      "metadata": {
        "grade_level": "{{ metadata.grade_level }}",
        "domain_category": "{{ metadata.domain_category }}",
        "teacher_name": "{{ metadata.teacher_name }}",
        "heroImage": {% if course.hero_image %}"{{ course.hero_image }}"{% else %}null{% endif %}
      },
      "url": "{{ ('/courses/' + course.slug + '/') | url }}",
      "tags": [{% for tag in courseTags %}"{{ tag | replace('"', '\\"') }}"{{ "," if not loop.last }}{% endfor %}],
      {% if course.learningObjectives -%}
      "learningObjectives": [{% for obj in course.learningObjectives %}"{{ obj | replace('"', '\\"') }}"{{ "," if not loop.last }}{% endfor %}],
      {% else -%}
      "learningObjectives": [],
      {% endif -%}
      "pages": {
        "home": "{{ site.url }}{{ ('/courses/' + course.slug + '/') | url }}"
        {%- if docStory -%}
        ,"story": "{{ site.url }}{{ ('/courses/' + course.slug + '/story/') | url }}"
        {%- endif -%}
        ,"play_script": "{{ site.url }}{{ ('/courses/' + course.slug + '/play-script/') | url }}"
        ,"workbook": "{{ site.url }}{{ ('/courses/' + course.slug + '/workbook/') | url }}"
        {%- if hasPhotos -%}
        ,"photos": "{{ site.url }}{{ ('/courses/' + course.slug + '/photos/') | url }}"
        {%- endif -%}
        {%- if hasBlackboard -%}
        ,"blackboard": "{{ site.url }}{{ ('/courses/' + course.slug + '/blackboard/') | url }}"
        {%- endif -%}
        ,"scripts": "{{ site.url }}{{ ('/courses/' + course.slug + '/scripts/') | url }}"
        ,"songs": "{{ site.url }}{{ ('/courses/' + course.slug + '/songs/') | url }}"
        {%- if hasSheetMusic -%}
        ,"sheet_music": "{{ site.url }}{{ ('/courses/' + course.slug + '/sheet-music/') | url }}"
        {%- endif -%}
        {%- if hasVideos -%}
        ,"videos": "{{ site.url }}{{ ('/courses/' + course.slug + '/videos/') | url }}"
        {%- endif -%}
      },
      "materials": {
        "hasStory": {% if docStory %}true{% else %}false{% endif %},
        "hasPlayScript": {% if docPlayScript or hasPlayScriptMaterial %}true{% else %}false{% endif %},
        "hasWorkbook": {% if hasWorkbook %}true{% else %}false{% endif %},
        "hasPhotos": {% if hasPhotos %}true{% else %}false{% endif %},
        "hasBlackboard": {% if hasBlackboard %}true{% else %}false{% endif %},
        "hasScripts": {% if hasScripts %}true{% else %}false{% endif %},
        "hasAudio": {% if hasAudio %}true{% else %}false{% endif %},
        "hasSheetMusic": {% if hasSheetMusic %}true{% else %}false{% endif %},
        "hasVideos": {% if hasVideos %}true{% else %}false{% endif %}
      },
      "docs": {
        {%- if course.docs -%}
        {%- set docEntries = [] -%}
        {%- for docKey, docData in course.docs -%}
          {%- if docData and docData.content -%}
            {%- set _ = docEntries.push({key: docKey, data: docData}) -%}
          {%- endif -%}
        {%- endfor -%}
        {%- for docEntry in docEntries -%}
        "{{ docEntry.key }}": {
          "name": {{ docEntry.data.name | jsonstr | safe }},
          "content": {{ docEntry.data.content | jsonstr | safe }},
          "mimeType": "{{ docEntry.data.mimeType }}",
          "downloadUrl": "{{ docEntry.data.downloadUrl }}",
          "lastSynced": "{{ docEntry.data.lastSynced }}"
        }{{ "," if not loop.last }}
        {%- endfor -%}
        {%- endif -%}
      },
      "driveContent": {
        {%- if course.material -%}
        {%- set materialKeys = ["workbook_photos", "photos", "blackboard", "scripts_photos", "songs_audio", "sheet_music", "workbook_pdfs", "play_scripts", "worksheet", "syllabus"] -%}
        {%- set materialEntries = [] -%}
        {%- for materialKey in materialKeys -%}
          {%- if course.material[materialKey] -%}
            {%- set allItems = [] -%}
            {%- for entry in course.material[materialKey] -%}
              {%- if entry.items and (entry.items | length) > 0 -%}
                {%- for item in entry.items -%}
                  {%- set _ = allItems.push(item) -%}
                {%- endfor -%}
              {%- endif -%}
            {%- endfor -%}
            {%- if (allItems | length) > 0 -%}
              {%- set _ = materialEntries.push({key: materialKey, items: allItems}) -%}
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
        {%- for matEntry in materialEntries -%}
        "{{ matEntry.key }}": [
          {%- for item in matEntry.items -%}
          {
            "id": "{{ item.id }}",
            "name": "{{ item.name | replace('"', '\\"') }}",
            "mimeType": "{{ item.mimeType }}",
            "tags": [{% for tag in item.tags %}"{{ tag | replace('"', '\\"') }}"{{ "," if not loop.last }}{% endfor %}],
            "downloadUrl": "{{ item.downloadUrl }}",
            "previewUrl": "{{ item.previewUrl }}",
            "thumbnailUrl": "https://drive.google.com/thumbnail?id={{ item.id }}&sz=w400",
            "directViewUrl": "https://drive.google.com/uc?export=view&id={{ item.id }}"
            {%- if item.mimeType == "application/pdf" and pdfTextCache and pdfTextCache[course.slug] and pdfTextCache[course.slug][matEntry.key] and pdfTextCache[course.slug][matEntry.key][item.id] -%}
            {%- set pdfCache = pdfTextCache[course.slug][matEntry.key][item.id] -%}
            ,"pdfText": {{ pdfCache.text | jsonstr | safe }}
            ,"pdfTextLastSynced": "{{ pdfCache.lastSynced }}"
            {%- endif -%}
          }{{ "," if not loop.last }}
          {%- endfor -%}
        ]{{ "," if not loop.last }}
        {%- endfor -%}
        {%- endif -%}
      }
    }{{ "," if not loop.last }}
    {%- endfor -%}
  ],
  "statistics": {
    "totalGrades": {{ coursesList | map('grade') | uniq | length }},
    "totalDomains": {{ coursesList | map('domain') | uniq | length }},
    "totalTeachers": {{ coursesList | map('teacher') | uniq | length }},
    "uniqueTags": {{ coursesList | map('tags') | flatten | uniq | length }}
  },
  "usage": {
    "description": "This AI-readable index provides structured access to all course data",
    "queryExamples": [
      "List all Grade 2 courses",
      "Find courses by teacher name",
      "Get all drama courses",
      "Compare blackboard drawing across grades"
    ],
    "documentation": "{{ '/for-ai/' | url }}"
  }
}
