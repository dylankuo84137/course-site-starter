---
layout: layouts/base.njk
permalink: /
currentLang: zh-TW
---
{% import "macros/i18n.njk" as i18nMacro %}

{% set langData = i18n[currentLang] %}
{% if not langData %}{% set langData = i18n['zh-TW'] %}{% endif %}
{% set homepageStrings = langData.homepage or {} %}
{% set uniqueTags = [] %}

{% for course in coursesList %}
  {% for tag in course.tags or [] %}
    {% if uniqueTags.indexOf(tag) == -1 %}
      {% set uniqueTags = uniqueTags.concat([tag]) %}
    {% endif %}
  {% endfor %}
{% endfor %}

{% set featuredTags = uniqueTags.slice(0, 8) %}

{% set domainSlugs = [] %}
{% for course in coursesList %}
  {% set domainSlug = course.metadata.domain_category if course.metadata else '' %}
  {% if domainSlug and domainSlugs.indexOf(domainSlug) == -1 %}
    {% set domainSlugs = domainSlugs.concat([domainSlug]) %}
  {% endif %}
{% endfor %}

{% set homepageCategorySource = homepageStrings.categories or [] %}
{% set homepageCategories = [] %}
{% set sourcedDomains = [] %}
{% for category in homepageCategorySource %}
  {% set slug = category.slug or category.anchor %}
  {% if slug and domainSlugs.indexOf(slug) != -1 %}
    {% set homepageCategories = homepageCategories.concat([{
      'slug': slug,
      'label': category.label,
      'description': category.description,
      'icon': category.icon or 'â¬©'
    }]) %}
    {% set sourcedDomains = sourcedDomains.concat([slug]) %}
  {% endif %}
{% endfor %}
{% for domainSlug in domainSlugs %}
  {% if sourcedDomains.indexOf(domainSlug) == -1 %}
    {% set fallbackLabel = (domainSlug | replace('-', ' ')) | title %}
    {% set homepageCategories = homepageCategories.concat([{
      'slug': domainSlug,
      'label': fallbackLabel,
      'description': '',
      'icon': 'â¬©'
    }]) %}
  {% endif %}
{% endfor %}
{% set homepageTestimonials = homepageStrings.testimonials or [] %}

{% if currentLang == 'en-US' %}
  {% set heroAlt = 'Illustration of teachers and students learning together in a Waldorf classroom' %}
  {% set tagAriaLabel = 'Course tags' %}
  {% set categoryAriaLabel = 'Browse course categories' %}
  {% set testimonialAriaLabel = 'Community testimonials' %}
{% else %}
  {% set heroAlt = 'è€å¸«èˆ‡å­©å­åœ¨è¯å¾·ç¦æ•™å®¤å…±åŒå‰µä½œçš„æº«æš–æ’ç•«' %}
  {% set tagAriaLabel = 'èª²ç¨‹æ¨™ç±¤' %}
  {% set categoryAriaLabel = 'ç€è¦½èª²ç¨‹åˆ†é¡' %}
  {% set testimonialAriaLabel = 'æ•™å¸«èˆ‡å­¸ç”Ÿæ¨è–¦' %}
{% endif %}

<section class="homepage-shell" data-pagefind-ignore>
  <div class="home-hero{% if homepageStrings.eyebrow %} home-hero--with-eyebrow{% endif %}">
    <div class="home-hero-content">
      {% if homepageStrings.eyebrow %}
      <p class="home-eyebrow" data-i18n="homepage.eyebrow">{{ homepageStrings.eyebrow }}</p>
      {% endif %}
      <h1 data-i18n="homepage.hero_title">{{ homepageStrings.hero_title or langData.site.title }}</h1>
      <p class="home-hero-description" data-i18n="site.homepage_description">{{ langData.site.homepage_description or '' }}</p>
      <div class="home-cta-group">
        <a class="home-cta-primary" href="{{ '/courses/' | url }}" data-i18n="homepage.hero_primary_cta">{{ homepageStrings.hero_primary_cta or langData.nav.courses }}</a>
        <a class="home-cta-secondary" href="#innovations" data-i18n="homepage.hero_secondary_cta"><span aria-hidden="true">ğŸ’¡</span> {{ homepageStrings.hero_secondary_cta }}</a>
      </div>
      <div class="home-search" id="search" aria-label="{{ i18n[currentLang].filters.search_placeholder }}"></div>
    </div>
    <div class="home-hero-media">
      <figure class="home-illustration">
        <img src="{{ '/images/Cixin_Weaver_web_banner.png' | url }}" alt="{{ heroAlt }}" loading="lazy" decoding="async">
      </figure>
    </div>
  </div>


  {# ==================== CATEGORY CARDS ==================== #}
  {% if homepageCategories.length %}
  <section class="home-categories" aria-labelledby="home-categories-heading">
    <div class="home-section-heading">
      <div>
        <h2 id="home-categories-heading" data-i18n="homepage.category_section_title">{{ homepageStrings.category_section_title }}</h2>
        <p data-i18n="homepage.category_section_copy">{{ homepageStrings.category_section_copy }}</p>
      </div>
    </div>
    <div class="home-category-grid" aria-label="{{ categoryAriaLabel }}">
      {% for category in homepageCategories %}
      {% set categoryHref = ('/courses/' | url) + '?domain=' + (category.slug | urlencode) %}
      <a class="home-category-card" href="{{ categoryHref }}">
        <span class="home-category-icon" aria-hidden="true">{{ category.icon or 'â¬©' }}</span>
        <strong class="home-category-label">{{ category.label }}</strong>
      </a>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  {# ==================== INNOVATION HIGHLIGHTS SLIDER ==================== #}
  {# Include courses that have innovation_summary or innovation_question in i18n #}
  {% set featuredInnovations = [] %}
  {% for c in coursesList %}
    {% set innovationSummary = i18nMacro.cf(c, 'innovation_summary', currentLang) %}
    {% set innovationQuestion = i18nMacro.cf(c, 'innovation_question', currentLang) %}
    {% if innovationSummary or innovationQuestion %}
      {% set featuredInnovations = (featuredInnovations.push(c), featuredInnovations) %}
    {% endif %}
  {% endfor %}

  {% if featuredInnovations.length > 0 %}
  <section class="home-innovations" id="innovations" aria-labelledby="home-innovations-heading">
    <div class="home-section-heading">
      <div>
        <h2 id="home-innovations-heading" data-i18n="homepage.innovation_section_title">{{ homepageStrings.innovation_section_title or 'æ•™å­¸å‰µæ–°äº®é»' }}</h2>
        <p data-i18n="homepage.innovation_section_copy">{{ homepageStrings.innovation_section_copy or 'çœ‹è¦‹è€å¸«å€‘å¦‚ä½•åœ¨å‚³çµ±æ¶æ§‹ä¸­çªç ´æ¡†æ¶' }}</p>
      </div>
    </div>

    <div class="home-innovation-slider-wrapper">
      <div class="home-innovation-nav-controls">
        <button class="home-innovation-nav home-innovation-nav-left" aria-label="{{ i18n[currentLang].homepage.innovation_prev or 'Previous innovation' }}" type="button">
          <span aria-hidden="true">â€¹</span>
        </button>
        <button class="home-innovation-nav home-innovation-nav-right" aria-label="{{ i18n[currentLang].homepage.innovation_next or 'Next innovation' }}" type="button">
          <span aria-hidden="true">â€º</span>
        </button>
      </div>
      <div class="home-innovation-slider" id="innovation-slider" role="region" aria-label="{{ i18n[currentLang].homepage.innovation_slider_label or 'Teaching innovation highlights' }}">
        {% for c in featuredInnovations %}
        {% set innovationSummary = i18nMacro.cf(c, 'innovation_summary', currentLang) %}
        {% set innovationQuestion = i18nMacro.cf(c, 'innovation_question', currentLang) %}
        {% set hasInnovationContent = courseInnovations[c.slug] %}

        <article class="home-innovation-card"
                 data-course-i18n="{{ c.i18n | json }}"
                 data-course-url="{{ ('/courses/' + c.slug + '/') | url }}"
                 style="cursor: pointer;"
                 role="link"
                 tabindex="0"
                 aria-label="{{ i18nMacro.cf(c, 'title', currentLang) }} - {{ i18n[currentLang].course.course_home }}">
          {% if c.hero_image %}
          <div class="home-innovation-card-image">
            <img src="https://drive.google.com/thumbnail?id={{ c.hero_image }}&sz=w1200"
                 alt="{{ i18nMacro.cf(c, 'title', currentLang) }}"
                 loading="lazy">
            <span class="home-innovation-badge" data-i18n-course="domain">{{ i18nMacro.cf(c, 'domain', currentLang) }}</span>
          </div>
          {% endif %}

          <div class="home-innovation-card-content">
            <p class="home-innovation-meta">
              <span data-i18n-course="grade">{{ i18nMacro.cf(c, 'grade', currentLang) }}</span> â€¢ <span data-i18n-course="unit">{{ i18nMacro.cf(c, 'unit', currentLang) }}</span>
            </p>
            <h3 class="home-innovation-title" data-i18n-course="innovation_question">
              {{ innovationQuestion or i18nMacro.cf(c, 'title', currentLang) }}
            </h3>
            <p class="home-innovation-summary" data-i18n-course="innovation_summary" data-truncate="54">
              {{ (innovationSummary or i18nMacro.cf(c, 'overview', currentLang)) | truncate(54) }}
            </p>

            <div class="home-innovation-footer">
              {% if c.metadata.teacher_name %}
              <div class="home-innovation-teacher">
                <span class="teacher-badge">{{ c.metadata.teacher_name }}</span>
              </div>
              {% endif %}
              {% if hasInnovationContent %}
              <a href="{{ ('/courses/' + c.slug + '/innovation/') | url }}"
                 class="home-innovation-cta"
                 onclick="event.stopPropagation()">
                <span data-i18n="homepage.innovation_cta">{{ homepageStrings.innovation_cta or 'é–±è®€åæ€' }}</span> â†’
              </a>
              {% endif %}
            </div>
          </div>
        </article>
        {% endfor %}

        {# Add placeholder cards if fewer than 3 innovations #}
        {% if featuredInnovations.length < 3 %}
          {% for i in range(0, 3 - featuredInnovations.length) %}
          <article class="home-innovation-card placeholder" aria-hidden="true">
            <div class="home-innovation-card-image">
              <span class="home-innovation-badge" data-i18n="homepage.innovation_section_title">{{ i18n[currentLang].homepage.innovation_section_title or 'æ•™å­¸å‰µæ–°' }}</span>
            </div>
            <div class="home-innovation-card-content">
              <p class="home-innovation-meta" data-i18n="homepage.innovation_placeholder_meta">{{ i18n[currentLang].homepage.innovation_placeholder_meta or 'å³å°‡æ¨å‡º' }}</p>
              <h3 class="home-innovation-title" data-i18n="homepage.innovation_placeholder_title">{{ i18n[currentLang].homepage.innovation_placeholder_title or 'æ›´å¤šæ•™å­¸å‰µæ–°åˆ†äº«' }}</h3>
              <p class="home-innovation-summary" data-i18n="homepage.innovation_placeholder_desc">{{ i18n[currentLang].homepage.innovation_placeholder_desc or 'æˆ‘å€‘æŒçºŒè¨˜éŒ„è€å¸«å€‘çš„æ•™å­¸å¯¦é©—èˆ‡åæ€ï¼Œæ•¬è«‹æœŸå¾…æ›´å¤šç²¾å½©å…§å®¹ã€‚' }}</p>
              <div class="home-innovation-footer">
                <div class="home-innovation-teacher">
                  <span class="teacher-badge teacher-badge-placeholder" data-i18n="homepage.innovation_placeholder_author">{{ i18n[currentLang].homepage.innovation_placeholder_author or 'ç±Œå‚™ä¸­' }}</span>
                </div>
              </div>
            </div>
          </article>
          {% endfor %}
        {% endif %}
      </div>
    </div>
  </section>
  {% endif %}

  <section class="home-ethos" id="ethos" aria-label="{{ homepageStrings.ethos_title or langData.site.title }}">
    <div>
      <h3 data-i18n="homepage.ethos_title">{{ homepageStrings.ethos_title or langData.site.title }}</h3>
      <p data-i18n="homepage.ethos_copy">{{ homepageStrings.ethos_copy or langData.site.homepage_description }}</p>
      {% if homepageStrings.ethos_points %}
      <ul>
        {% for point in homepageStrings.ethos_points %}
        <li data-i18n="homepage.ethos_points.{{ loop.index0 }}">{{ point }}</li>
        {% endfor %}
      </ul>
      {% endif %}
    </div>
    <div>
      <img src="{{ '/images/Cixin_home_ethos_banner.png' | url }}" alt="{{ heroAlt }}" loading="lazy" decoding="async">
    </div>
  </section>

  <section class="home-testimonials" style="display: none;" aria-labelledby="home-testimonials-heading">
    <div class="home-section-heading">
      <div>
        <h2 id="home-testimonials-heading" data-i18n="homepage.testimonials_title">{{ homepageStrings.testimonials_title }}</h2>
        <p data-i18n="homepage.testimonials_copy">{{ homepageStrings.testimonials_copy }}</p>
      </div>
    </div>
    <div class="home-testimonial-list" aria-label="{{ testimonialAriaLabel }}">
      {% for testimonial in homepageStrings.testimonials %}
      <article class="home-testimonial-card">
        <p class="home-testimonial-quote" data-i18n="homepage.testimonials.{{ loop.index0 }}.quote">"{{ testimonial.quote }}"</p>
        <p class="home-testimonial-author" data-i18n="homepage.testimonials.{{ loop.index0 }}.author">â€” {{ testimonial.author }}</p>
      </article>
      {% endfor %}
    </div>
  </section>
</section>
