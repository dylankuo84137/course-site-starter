---
layout: layouts/base.njk
permalink: /
currentLang: zh-TW
hidePagefindSearch: true
---
{% import "macros/i18n.njk" as i18nMacro %}

{% set langData = i18n[currentLang] %}
{% if not langData %}{% set langData = i18n['zh-TW'] %}{% endif %}
{% set homepageStrings = langData.homepage or {} %}
{% set uniqueTags = [] %}

{% for course in coursesList %}
  {% for tag in course.tags or [] %}
    {% if uniqueTags.indexOf(tag) == -1 %}
      {% set uniqueTags = uniqueTags.concat([tag]) %}
    {% endif %}
  {% endfor %}
{% endfor %}

{% set featuredTags = uniqueTags.slice(0, 8) %}

{% set domainSlugs = [] %}
{% for course in coursesList %}
  {% set domainSlug = course.metadata.domain_category if course.metadata else '' %}
  {% if domainSlug and domainSlugs.indexOf(domainSlug) == -1 %}
    {% set domainSlugs = domainSlugs.concat([domainSlug]) %}
  {% endif %}
{% endfor %}

{% set homepageCategorySource = homepageStrings.categories or [] %}
{% set homepageCategories = [] %}
{% set sourcedDomains = [] %}
{% for category in homepageCategorySource %}
  {% set slug = category.slug or category.anchor %}
  {% if slug and domainSlugs.indexOf(slug) != -1 %}
    {% set homepageCategories = homepageCategories.concat([{
      'slug': slug,
      'label': category.label,
      'description': category.description,
      'icon': category.icon or '⬩'
    }]) %}
    {% set sourcedDomains = sourcedDomains.concat([slug]) %}
  {% endif %}
{% endfor %}
{% for domainSlug in domainSlugs %}
  {% if sourcedDomains.indexOf(domainSlug) == -1 %}
    {% set fallbackLabel = (domainSlug | replace('-', ' ')) | title %}
    {% set homepageCategories = homepageCategories.concat([{
      'slug': domainSlug,
      'label': fallbackLabel,
      'description': '',
      'icon': '⬩'
    }]) %}
  {% endif %}
{% endfor %}
{% set homepageTestimonials = homepageStrings.testimonials or [] %}

{% if currentLang == 'en-US' %}
  {% set heroAlt = 'Illustration of teachers and students learning together in a Waldorf classroom' %}
  {% set tagAriaLabel = 'Course tags' %}
  {% set categoryAriaLabel = 'Browse course categories' %}
  {% set testimonialAriaLabel = 'Community testimonials' %}
{% else %}
  {% set heroAlt = '老師與孩子在華德福教室共同創作的溫暖插畫' %}
  {% set tagAriaLabel = '課程標籤' %}
  {% set categoryAriaLabel = '瀏覽課程分類' %}
  {% set testimonialAriaLabel = '教師與學生推薦' %}
{% endif %}

<section class="homepage-shell">
  <div class="home-hero{% if homepageStrings.eyebrow %} home-hero--with-eyebrow{% endif %}">
    <div class="home-hero-content">
      {% if homepageStrings.eyebrow %}
      <p class="home-eyebrow">{{ homepageStrings.eyebrow }}</p>
      {% endif %}
      <h1>{{ homepageStrings.hero_title or langData.site.title }}</h1>
      <p class="home-hero-description" data-i18n="site.homepage_description">{{ langData.site.homepage_description or '' }}</p>
      <div class="home-cta-group">
        <a class="home-cta-primary" href="{{ '/courses/' | url }}">{{ homepageStrings.hero_primary_cta or langData.nav.courses }}</a>
        <a class="home-cta-secondary" href="#ethos">{{ homepageStrings.hero_secondary_cta or langData.nav.home }}</a>
      </div>
      <div class="home-search" id="search" aria-label="{{ i18n[currentLang].filters.search_placeholder }}"></div>
    </div>
    <div class="home-hero-media">
      <figure class="home-illustration">
        <img src="{{ '/images/Cixin_Weaver_web_banner.png' | url }}" alt="{{ heroAlt }}" loading="lazy" decoding="async">
      </figure>
    </div>
  </div>


  <section aria-labelledby="home-courses-heading">
    <div class="home-section-heading">
      <div>
        <h2 id="home-courses-heading">{{ homepageStrings.course_section_title or langData.nav.courses }}</h2>
        <p>{{ homepageStrings.course_section_copy or langData.site.homepage_description }}</p>
      </div>
      {% if featuredTags.length %}
      <div class="home-tag-section">
        {% if homepageStrings.tag_intro %}
        <p class="home-tag-label">{{ homepageStrings.tag_intro }}</p>
        {% endif %}
        <div class="home-tag-strip" aria-label="{{ tagAriaLabel }}">
          {% for tag in featuredTags %}
          <span class="home-tag">#{{ tag }}</span>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>

    <div class="home-course-grid mt-10">
      {% for c in coursesList %}
      {% set courseDescriptionDoc = materialHelpers.getDoc(c, 'course_description') %}
      {% set hasWorkbook = materialHelpers.hasMaterial(c, 'workbook_photos') or materialHelpers.hasMaterial(c, 'workbook_pdfs') %}
      {% set hasSyllabus = materialHelpers.hasMaterial(c, 'syllabus') %}
      {% set hasWorksheet = materialHelpers.hasMaterial(c, 'worksheet') %}
      {% set hasBlackboard = materialHelpers.hasMaterial(c, 'blackboard') %}
      {% set hasPhotos = materialHelpers.hasMaterial(c, 'photos') %}
      {% set hasPlayScript = materialHelpers.getDoc(c, 'play_script') or materialHelpers.hasMaterial(c, 'play_scripts') %}
      {% set hasScripts = materialHelpers.hasMaterial(c, 'scripts_photos') %}
      {% set hasSongs = materialHelpers.hasMaterial(c, 'songs_audio') %}
      {% set hasSheetMusic = materialHelpers.hasMaterial(c, 'sheet_music') %}
      {% set hasStory = materialHelpers.getDoc(c, 'story') %}
      {% set hasVideos = materialHelpers.hasMaterial(c, 'videos') %}
      <article class="home-course-card" data-course-slug="{{ c.slug }}" data-course-i18n="{{ c.i18n | json }}">
        <div class="home-card-header">
          <div class="home-card-meta">
            <span data-i18n-course="grade">{{ i18nMacro.cf(c, 'grade', currentLang) }}</span>
            <span aria-hidden="true">•</span>
            <span data-i18n-course="semester">{{ i18nMacro.cf(c, 'semester', currentLang) }}</span>
            <span aria-hidden="true">｜</span>
            <span data-i18n-course="unit">{{ i18nMacro.cf(c, 'unit', currentLang) }}</span>
            <span aria-hidden="true">•</span>
            <span data-i18n-course="domain">{{ i18nMacro.cf(c, 'domain', currentLang) }}</span>
          </div>
          <h2 class="home-card-title">
            <a href="{{ '/courses/' | url }}{{ c.slug }}/" data-i18n-course="title">{{ i18nMacro.cf(c, 'title', currentLang) }}</a>
          </h2>
        </div>
        <div class="home-card-body">
          <p data-i18n-course="overview">{{ i18nMacro.cf(c, 'overview', currentLang) or '' }}</p>
        </div>
        {% if c.tags and c.tags.length %}
        <div class="home-tag-list">
          {% for tag in c.tags.slice(0, 3) %}
          <span class="home-tag-pill">#{{ tag }}</span>
          {% endfor %}
        </div>
        {% endif %}
        <div class="home-material-links">
          {% if courseDescriptionDoc %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/">{{ i18n[currentLang].course.course_home }}</a>
          {% endif %}
          {% if hasWorkbook %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/workbook/">{{ i18n[currentLang].course.workbook }}</a>
          {% endif %}
          {% if hasSyllabus %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/syllabus/">{{ i18n[currentLang].course.syllabus }}</a>
          {% endif %}
          {% if hasWorksheet %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/worksheet/">{{ i18n[currentLang].course.worksheet }}</a>
          {% endif %}
          {% if hasBlackboard %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/blackboard/">{{ i18n[currentLang].course.blackboard_drawings }}</a>
          {% endif %}
          {% if hasPhotos %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/photos/">{{ i18n[currentLang].course.photo_gallery }}</a>
          {% endif %}
          {% if hasPlayScript %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/play-script/">{{ i18n[currentLang].course.play_script }}</a>
          {% endif %}
          {% if hasScripts %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/scripts/">{{ i18n[currentLang].course.performance }}</a>
          {% endif %}
          {% if hasSongs %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/songs/">{{ i18n[currentLang].course.songs }}</a>
          {% endif %}
          {% if hasSheetMusic %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/sheet-music/">{{ i18n[currentLang].course.sheet_music }}</a>
          {% endif %}
          {% if hasStory %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/story/">{{ i18n[currentLang].course.story }}</a>
          {% endif %}
          {% if hasVideos %}
          <a class="home-material-link" href="{{ '/courses/' | url }}{{ c.slug }}/videos/">{{ i18n[currentLang].course.video }}</a>
          {% endif %}
        </div>
      </article>
      {% endfor %}
    </div>
  </section>

  {% if homepageCategories.length %}
  <section class="home-categories" aria-labelledby="home-categories-heading">
    <div class="home-section-heading">
      <div>
        <h2 id="home-categories-heading">{{ homepageStrings.category_section_title }}</h2>
        <p>{{ homepageStrings.category_section_copy }}</p>
      </div>
    </div>
    <div class="home-category-grid" aria-label="{{ categoryAriaLabel }}">
      {% for category in homepageCategories %}
      {% set categoryHref = ('/courses/' | url) + '?domain=' + (category.slug | urlencode) %}
      <a class="home-category-card" href="{{ categoryHref }}">
        <span class="home-category-icon" aria-hidden="true">{{ category.icon or '⬩' }}</span>
        <strong class="home-category-label">{{ category.label }}</strong>
      </a>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <section class="home-ethos" id="ethos" aria-label="{{ homepageStrings.ethos_title or langData.site.title }}">
    <div>
      <h3>{{ homepageStrings.ethos_title or langData.site.title }}</h3>
      <p>{{ homepageStrings.ethos_copy or langData.site.homepage_description }}</p>
      {% if homepageStrings.ethos_points %}
      <ul>
        {% for point in homepageStrings.ethos_points %}
        <li>{{ point }}</li>
        {% endfor %}
      </ul>
      {% endif %}
    </div>
    <div>
      <img src="{{ '/images/Cixin_home_ethos_banner.png' | url }}" alt="{{ heroAlt }}" loading="lazy" decoding="async">
    </div>
  </section>

  <section class="home-testimonials" style="display: none;" aria-labelledby="home-testimonials-heading">
    <div class="home-section-heading">
      <div>
        <h2 id="home-testimonials-heading">{{ homepageStrings.testimonials_title }}</h2>
        <p>{{ homepageStrings.testimonials_copy }}</p>
      </div>
    </div>
    <div class="home-testimonial-list" aria-label="{{ testimonialAriaLabel }}">
      <article class="home-testimonial-card">
        <p class="home-testimonial-quote">"This is a placeholder testimonial for future content."</p>
        <p class="home-testimonial-author">— Placeholder Author 1</p>
      </article>
      <article class="home-testimonial-card">
        <p class="home-testimonial-quote">"This is another placeholder testimonial for future content."</p>
        <p class="home-testimonial-author">— Placeholder Author 2</p>
      </article>
      <article class="home-testimonial-card">
        <p class="home-testimonial-quote">"This is a third placeholder testimonial for future content."</p>
        <p class="home-testimonial-author">— Placeholder Author 3</p>
      </article>
    </div>
  </section>
</section>
