# æ…ˆå¿ƒèª²ç¨‹ç¹”åœ–

ä»¥ **Eleventy (11ty)** + **Tailwind CSS** + **Pagefind** è£½ä½œçš„**éœæ…‹èª²ç¨‹å±•ç¤ºç¶²ç«™**ã€‚  
è‡ªå‹•å¾ **Google Drive å…¬é–‹è³‡æ–™å¤¾**åŒæ­¥ç…§ç‰‡ï¼éŸ³æª”ï¼Œæ”¯æ´**å¤šèª²ç¨‹**ã€ç¸®åœ–ç€è¦½ï¼‹**Lightbox**ã€ç«™å…§æœå°‹èˆ‡**å¿«é€Ÿç¯©é¸**ã€‚

> å…§å®¹æˆæ¬Šï¼šCC BY-NCï¼›å«å­¸ç”Ÿç…§ç‰‡ä¹‹ç´ æå·²å–å¾—å…¬é–‹æˆæ¬Šã€‚  
> è¯çµ¡ï¼šit@waldorf.ilc.edu.tw

---

## âœ¨ åŠŸèƒ½ç¸½è¦½

- å¤šèª²ç¨‹å°è¦½ï¼šèª²ç¨‹ä¸»é ï¼ˆèª²ç¨‹åç¨±ï¼ç°¡ä»‹ï¼æ•™å¸«ä»‹ç´¹ï¼‰ï¼‹å…­å¤§åˆ†é   
  `å·¥ä½œæœ¬ï½œç…§ç‰‡é›†ï½œé»‘æ¿ç•«ï½œåŠ‡æœ¬ï½œæ­Œæ›²èˆ‡éŸ³æª”ï½œç•™è¨€èˆ‡äº¤æµ`
- Drive åŒæ­¥è…³æœ¬ï¼šå¾å…¬é–‹è³‡æ–™å¤¾æ“·å–æª”æ¡ˆæ¸…å–®ï¼Œç”¢ç”Ÿ JSONï¼ˆå¯æ‰‹å‹•è¦†å¯«ï¼‰
- åœ–ç‰‡ç›¸ç°¿ï¼šç¸®åœ–æ ¼ç‹€ç€è¦½ã€é»æ“Šæ”¾å¤§ã€**æ–¹å‘éµåˆ‡æ›**ã€**ESC é—œé–‰**
- å¿«é€Ÿç¯©é¸ï¼ˆåƒ…ç›¸ç°¿é ï¼‰ï¼šè¼¸å…¥å¤šå€‹é—œéµå­—ï¼ˆ**AND æ¢ä»¶**ï¼‰å³æ™‚éæ¿¾
- ç«™å…§æœå°‹ï¼ˆPagefindï¼‰ï¼šæœå°‹èª²ç¨‹æ–‡å­—å…§å®¹ï¼ˆé¦–é ï¼èª²ç¨‹é ç­‰ï¼‰
- æ¨™ç±¤ç³»çµ±ï¼š  
  - **è‡ªå‹•å¾æª”åæ“·å–** `[æ–¹æ‹¬è™Ÿ]`ï¼`ã€å…¨å½¢ã€‘`ï¼`#hashtag`  
  - **è‡ªå‹•é™„åŠ èª²ç¨‹å±¤ç´šæ¨™ç±¤**ï¼šå¹´ç´šã€å­¸æœŸã€ä¸»é¡Œå–®å…ƒã€èª²ç¨‹é ˜åŸŸ  
- éŸ³æª”æ’­æ”¾ï¼šç›´æ¥ä¸²æµ Google Drive (`uc?export=download&id=...`) æˆ–ä¸‹è¼‰  
- é©åˆ GitHub Pages ç™¼ä½ˆï¼ˆç´”éœæ…‹ã€ç„¡ä¼ºæœå™¨ï¼‰

---

## ğŸ§± å°ˆæ¡ˆæ¶æ§‹

```
course-site/
â”œâ”€ .eleventy.js                    # 11ty è¨­å®š
â”œâ”€ package.json                    # æŒ‡ä»¤èˆ‡å¥—ä»¶
â”œâ”€ scripts/
â”‚  â””â”€ fetch-drive.mjs             # Drive åŒæ­¥è…³æœ¬ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€ public/
â”‚  â”œâ”€ css/site.css                # åŸºæœ¬æ¨£å¼ï¼ˆè£œ Tailwindï¼‰
â”‚  â””â”€ js/gallery.js               # Lightbox + å¿«é€Ÿç¯©é¸
â””â”€ src/
   â”œâ”€ _data/
   â”‚  â”œâ”€ site.json                # ç«™åã€é å°¾ã€è¯çµ¡ç­‰
   â”‚  â”œâ”€ coursesList.js           # æƒææ‰€æœ‰ course_*.json
   â”‚  â””â”€ course_*.json           # æ¯ä¸€é–€èª²ç¨‹çš„è³‡æ–™ï¼ˆé‡è¦ï¼‰
   â”œâ”€ _includes/
   â”‚  â”œâ”€ layouts/base.njk         # ç‰ˆå‹ï¼ˆPagefind å‹•æ…‹è¼‰å…¥ï¼‰
   â”‚  â””â”€ components/
   â”‚     â”œâ”€ course_nav.njk        # èª²ç¨‹åˆ†é å°è¦½
   â”‚     â””â”€ drive.njk             # ç›¸ç°¿ç¸®åœ–æ ¼ï¼å¤§åœ–é è¦½
   â”œâ”€ courses/
   â”‚  â”œâ”€ index.njk                # æ‰€æœ‰èª²ç¨‹åˆ—è¡¨
   â”‚  â”œâ”€ home.njk                 # èª²ç¨‹ä¸»é 
   â”‚  â”œâ”€ workbook.njk             # å·¥ä½œæœ¬ï¼ˆç›¸ç°¿ï¼‰
   â”‚  â”œâ”€ photos.njk               # ç…§ç‰‡é›†ï¼ˆç›¸ç°¿ï¼‰
   â”‚  â”œâ”€ blackboard.njk           # é»‘æ¿ç•«ï¼ˆç›¸ç°¿ï¼‰
   â”‚  â”œâ”€ scripts.njk              # åŠ‡æœ¬ï¼ˆç›¸ç°¿ï¼‰
   â”‚  â””â”€ songs.njk                # æ­Œæ›²èˆ‡éŸ³æª”ï¼ˆ<audio>æ’­æ”¾ï¼‰
   â”œâ”€ reflections/
   â”‚  â””â”€ index.njk                # ç•™è¨€èˆ‡äº¤æµï¼ˆæŠ•ææŒ‡å¼•ï¼ä¿¡ç®±ï¼‰
   â””â”€ index.njk                   # é¦–é ï¼ˆèª²ç¨‹å¿«é€Ÿå°è¦½ï¼‰
```

---

## ğŸ—‚ï¸ è³‡æ–™çµæ§‹ï¼ˆ`course_*.json`ï¼‰

æ¯é–€èª²ä¸€å€‹ JSON æª”ï¼Œç¯„ä¾‹ï¼š

```json
{
  "slug": "2a-nenggao-113-summer",
  "title": "èƒ½é«˜å±±ï¼ˆç­ç´šæˆ²åŠ‡ï¼‰",
  "grade": "äºŒå¹´ç´š 2A å¶ºå…‰ç­",
  "semester": "113 å­¸å¹´åº¦ å¤å­£",
  "unit": "ç­ç´šæˆ²åŠ‡",
  "domain": "è‡ªç„¶ä¸»èª²",
  "teacher": "ç‹ç¬å©·",
  "tags": ["æˆ²åŠ‡", "é»‘æ¿ç•«", "å·¥ä½œæœ¬", "æ­Œæ›²"],
  "drive_folders": {
    "workbook_photos": "FOLDER_ID",
    "blackboard": "FOLDER_ID",
    "photos": "FOLDER_ID",
    "scripts_and_performance": "FOLDER_ID",
    "songs_audio": "FOLDER_ID"
  },
  "files": {
    "workbook_photos": [
      { "id": "FILE_ID", "name": "P01ã€ç¬¬1é€±ã€‘ã€è¢ç«èŸ²ã€‘", "tags": ["ç¬¬1é€±","è¢ç«èŸ²","äºŒå¹´ç´š 2A å¶ºå…‰ç­","113 å­¸å¹´åº¦ å¤å­£","ç­ç´šæˆ²åŠ‡","è‡ªç„¶ä¸»èª²"] }
    ],
    "blackboard": [ { "id": "FILE_ID", "name": "..." , "tags": ["..."] } ],
    "photos":    [ { "id": "FILE_ID", "name": "..." , "tags": ["..."] } ],
    "scripts_photos": [ { "id": "FILE_ID", "name": "..." , "tags": ["..."] } ],
    "songs": [
      { "title": "ä¸è¦æ‰å¼„", "id": "FILE_ID", "mimeType": "audio/x-m4a" }
    ]
  },
  "overview": "èª²ç¨‹ç°¡ä»‹æ–‡å­—ã€‚"
}
```

**é‡é»ï¼š**
- `drive_folders`ï¼šæ”¾å„åˆ†é¡çš„ **Google Drive è³‡æ–™å¤¾ ID**ï¼ˆéœ€è¨­ç‚ºã€ŒçŸ¥é“é€£çµçš„ä»»ä½•äººå¯æª¢è¦–ã€ï¼‰ã€‚  
- `files.*`ï¼šåŸ·è¡ŒåŒæ­¥è…³æœ¬å¾Œè‡ªå‹•è¦†å¯«ï¼›**åœ–ç‰‡æœƒå¯«æˆç‰©ä»¶ `{id,name,tags}`**ã€‚  
- æ¨™ç±¤ä¾†æºï¼š
  - ç”±æª”åè‡ªå‹•æ“·å–ï¼š`[æ–¹æ‹¬è™Ÿ]`ã€`ã€å…¨å½¢ã€‘`ã€`#hashtag`ï¼ˆä¾‹å¦‚ `P01ã€ç¬¬2é€±ã€‘ã€è¢ç«èŸ²ã€‘.jpg`ï¼‰  
  - ç”±èª²ç¨‹å±¤ç´šè‡ªå‹•é™„åŠ ï¼š`grade/semester/unit/domain`
- **éŸ³æª”**ï¼šä»¥ `{title,id,mimeType}` è¡¨ç¤ºï¼Œé é¢ä»¥ `<audio>` ä¸²æµæ’­æ”¾ã€‚

---

## ğŸ” Google Drive åŒæ­¥è…³æœ¬

### å–å¾— API Keyï¼ˆåªéœ€ä¸€æ¬¡ï¼‰
1. åˆ° Google Cloud Console é–‹å•Ÿå°ˆæ¡ˆä¸¦å•Ÿç”¨ **Drive API**ã€‚  
2. å»ºç«‹ **API é‡‘é‘°**ï¼ˆé™åˆ¶ç‚ºç‰¹å®š HTTP ä¾†æºæˆ– IPï¼‰ã€‚  
3. å°‡é‡‘é‘°è¨­åˆ°ç’°å¢ƒè®Šæ•¸ `GOOGLE_API_KEY`ã€‚

### åŸ·è¡ŒåŒæ­¥
```bash
GOOGLE_API_KEY=ä½ çš„APIé‡‘é‘° npm run sync:drive
```
è…³æœ¬æœƒï¼š
- è®€å– `src/_data/course_*.json`
- ä¾ `drive_folders` åˆ—å‡ºæ‰€æœ‰æª”æ¡ˆï¼ˆæ”¯æ´ **Shortcut** è½‰æ­£ï¼‰
- ç¯©é¸ï¼š`image/*` â†’ ç›¸ç°¿ï¼›`audio/*` â†’ æ­Œæ›²èˆ‡éŸ³æª”
- ç”¢ç”Ÿ `files.*` æ¸…å–®ï¼ˆå« `{id,name,tags}`ï¼‰ï¼Œä¸¦å‚™ä»½ç‚º `.bak`

> è‹¥åœ–ç‰‡ç„¡æ³•é¡¯ç¤ºï¼Œè«‹æª¢æŸ¥è©²æª”ï¼è³‡æ–™å¤¾æ˜¯å¦å…¬é–‹ã€‚éƒ¨åˆ†æª”æ¡ˆè‹¥ `uc?export=view` 403ï¼Œç³»çµ±æœƒæ”¹ç”¨ `thumbnail` ç«¯é»ï¼ˆä¸¦å…§å»ºå¾Œå‚™ï¼‰ã€‚

---

## ğŸ” æœå°‹èˆ‡ç¯©é¸

- **Pagefind ç«™å…§æœå°‹**ï¼šæœå°‹é é¢æ–‡å­—ï¼ˆé¦–é ï¼èª²ç¨‹ä¸»é ç­‰ï¼‰ã€‚  
  - **é–‹ç™¼æ¨¡å¼ï¼ˆnpm run devï¼‰**ï¼šv9.1 æœƒè‡ªå‹•åµæ¸¬æœ¬æ©Ÿ `/pagefind/*` æ˜¯å¦å­˜åœ¨ï¼›æ²’æœ‰å°±æ”¹ç”¨ **CDN**ï¼Œé¿å… 404/MIME éŒ¯èª¤ã€‚  
  - **æ­£å¼éƒ¨ç½²**ï¼š`npm run deploy` æœƒå»ºç«‹ç´¢å¼•åˆ° `_site/pagefind/*`ã€‚

- **ç›¸ç°¿å¿«é€Ÿç¯©é¸**ï¼ˆç›¸ç°¿é å³ä¸Šè§’è¼¸å…¥æ¡†ï¼‰ï¼š  
  - ä»¥ç©ºç™½åˆ†éš”å¤šå€‹é—œéµå­—ï¼ˆAND æ¢ä»¶ï¼‰  
  - æ¯”å°ç¯„åœï¼š**æª”åï¼ˆnameï¼‰ï¼‹ æ¨™ç±¤ï¼ˆtagsï¼‰ï¼‹ åœ–ç‰‡ Alt**

---

## ğŸ§ª é–‹ç™¼èˆ‡å»ºç½®

```bash
# å®‰è£
npm install

# é–‹ç™¼æ¨¡å¼ï¼ˆhttp://localhost:8080ï¼‰
npm run dev

# åªå»ºç½®éœæ…‹æª”ï¼ˆ_siteï¼‰
npm run build

# å»ºç½® + ç”¢ç”Ÿ Pagefind ç´¢å¼•
npm run deploy
```

---

## â˜ï¸ ç™¼ä½ˆåˆ° GitHub Pages

å…©ç¨®åšæ³•æ“‡ä¸€ï¼š

### æ–¹æ¡ˆ Aï¼šGitHub Actions è‡ªå‹•éƒ¨ç½²ï¼ˆå»ºè­°ï¼‰
1. å°‡å°ˆæ¡ˆæ¨åˆ° GitHubã€‚  
2. å»ºç«‹ workflowï¼ˆå·²é™„æ–¼ `.github/workflows/gh-pages.yml`ï¼‰ã€‚  
3. åˆ° **Settings â†’ Pages**ï¼Œå°‡ **Source** é¸æ“‡ **GitHub Actions**ã€‚  
4. æ¨é€åˆ° `main`ï¼ŒActions æœƒè‡ªå‹• build ä¸¦éƒ¨ç½²è‡³ Pagesã€‚

> è‹¥è¦åœ¨ CI å…§åŒæ­¥ Driveï¼ˆå¯é¸ï¼‰ï¼šåœ¨ repo **Settings â†’ Secrets â†’ Actions** å»ºç«‹ `GOOGLE_API_KEY`ï¼Œ
> ä¸¦è§£é™¤ workflow å…§å° `sync:drive` æ­¥é©Ÿçš„è¨»è§£ã€‚

### æ–¹æ¡ˆ Bï¼šæœ¬æ©Ÿå»ºç½®å¾Œæ¨åˆ° `gh-pages` åˆ†æ”¯
```bash
npm run deploy
git subtree push --prefix _site origin gh-pages
# è¨­å®š Pages Sourceï¼šgh-pages / æ ¹ç›®éŒ„
```

---

## ğŸ¨ å®¢è£½åŒ–

- ç«™åï¼é å°¾è³‡è¨Šï¼š`src/_data/site.json`  
- ç‰ˆé ­å°è¦½ï¼Pagefind è¼‰å…¥ç­–ç•¥ï¼š`src/_includes/layouts/base.njk`ï¼ˆå…§å»ºå‹•æ…‹è¼‰å…¥ï¼‰  
- ä¸»è¦–è¦ºè‰²å½©èˆ‡å…ƒä»¶å¾®èª¿ï¼š`public/css/site.css`  
- èª²ç¨‹å°è¦½å…ƒä»¶ï¼š`src/_includes/components/course_nav.njk`  
- ç›¸ç°¿å…ƒä»¶ï¼š`src/_includes/components/drive.njk`  
- Lightbox èˆ‡ç¯©é¸ï¼š`public/js/gallery.js`

---

## ğŸ§© æ–°å¢ä¸€é–€èª²

1. è¤‡è£½ `src/_data/course_2a_nenggao_113_summer.json` ç‚ºæ–°æª”ï¼Œä¿®æ”¹ï¼š  
   `slug/title/grade/semester/unit/domain/teacher/drive_folders`  
2. å°‡å°æ‡‰ Drive è³‡æ–™å¤¾è¨­ç‚ºã€ŒçŸ¥é“é€£çµçš„ä»»ä½•äººå¯æª¢è¦–ã€ã€‚  
3. åŸ·è¡ŒåŒæ­¥ï¼š

```bash
GOOGLE_API_KEY=ä½ çš„APIé‡‘é‘° npm run sync:drive
```

4. åœ¨ç€è¦½å™¨æª¢è¦– `/courses/ä½ çš„-slug/`ã€‚

---

## ğŸ› ï¸ ç–‘é›£æ’è§£

- **Pagefind MIME / 404**ï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰ï¼š  
  v9.1 å·²æ”¹ç‚º**å‹•æ…‹è¼‰å…¥**ï¼Œæœƒè‡ªå‹• fallback åˆ° CDNã€‚è‹¥ä»æœ‰ç•°å¸¸ï¼Œè«‹ç¡¬é‡æ–°æ•´ç†ï¼ˆCtrl/Cmd+Shift+Rï¼‰ã€‚
- **Drive ç…§ç‰‡ç„¡æ³•é¡¯ç¤º**ï¼š  
  æª¢æŸ¥æª”æ¡ˆæˆ–è³‡æ–™å¤¾æ˜¯å¦å…¬é–‹ï¼›å¿…è¦æ™‚æŠŠåœ–ç‰‡æ”¹èµ° `thumbnail`ï¼ˆç³»çµ±å·²è‡ªå‹•è™•ç†ï¼‰ã€‚
- **éŸ³æª”ç„¡æ³•æ’­æ”¾**ï¼š  
  æª¢æŸ¥éŸ³æª”æ˜¯å¦å…è¨±å…¬é–‹å­˜å–ï¼›ç€è¦½å™¨å¯èƒ½ä»¥ä¸²æµæˆ–ä¸‹è¼‰è™•ç†ï¼ˆä¾ MIME èˆ‡ç€è¦½å™¨è¡Œç‚ºï¼‰ã€‚
- **åŒæ­¥ä¸åˆ°æª”æ¡ˆ**ï¼š  
  ç¢ºèª `GOOGLE_API_KEY`ã€Drive API å·²å•Ÿç”¨ã€è³‡æ–™å¤¾ ID æ­£ç¢ºã€æœªè¢«å›æ”¶æ¡¶æˆ–é shortcut æŒ‡å‘ç§äººæª”æ¡ˆã€‚

---

## ğŸ“„ æˆæ¬Šèˆ‡ç‰ˆæ¬Š

- ç¶²ç«™åŸå§‹ç¢¼ï¼šMITï¼ˆå¯è‡ªç”±è¤‡ç”¨ï¼‰ã€‚  
- å…§å®¹ç´ æï¼š**CC BY-NC**ï¼›å«å­¸ç”Ÿä¹‹ç…§ç‰‡å·²å–å¾—æˆæ¬Šï¼Œä¸å¾—ç”¨æ–¼å•†æ¥­ç”¨é€”ã€‚  
- æ ¡æ–¹è¯çµ¡ï¼šit@waldorf.ilc.edu.tw

---

## ğŸ§¾ æŒ‡ä»¤ä¸€è¦½

```bash
npm install
npm run dev
GOOGLE_API_KEY=xxx npm run sync:drive
npm run build
npm run deploy
```
